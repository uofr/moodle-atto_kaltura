define(["jquery"],function(a){return{init:function(){function b(){null===a("#fileData")||null===a("#fileData").files||""===a("#name").val()||""===a("#tags").val()||""===a("#type").val()||"N/A"===a("#type").val()?(a("#entry_submit").prop("disabled",!0),a("#entry").val("")):a("#entry_submit").prop("disabled",!1)}function c(){return 0>=B?!1:B>2e9?!1:!0}function d(a){return-1!=a.indexOf("video/avi")||-1!=a.indexOf("video/x-msvideo")||-1!=a.indexOf("video/mpeg")||-1!=a.indexOf("video/mpg")||-1!=a.indexOf("video/mp4")||-1!=a.indexOf("video/ogg")||-1!=a.indexOf("video/quicktime")||-1!=a.indexOf("video/VP8")||-1!=a.indexOf("video/x-flv")||-1!=a.indexOf("video/x-f4v")||-1!=a.indexOf("video/x-matroska")||-1!=a.indexOf("video/x-ms-wmv")||-1!=a.indexOf("video/webm")?"video":-1!=a.indexOf("audio/ac3")||-1!=a.indexOf("audio/ogg")||-1!=a.indexOf("audio/mpeg")||-1!=a.indexOf("audio/mp4")||-1!=a.indexOf("audio/mp3")||-1!=a.indexOf("audio/wav")||-1!=a.indexOf("audio/x-ms-wma")?"audio":-1!=a.indexOf("image/gif")||-1!=a.indexOf("image/jpeg")||-1!=a.indexOf("image/png")||-1!=a.indexOf("image/tiff")?"image":"N/A"}function e(){var e="";if(a("#fileData")){var f=a("#fileData").prop("files")[0];B=parseInt(f.size);var g=d(encodeURI(f.type)),h=c();if(require(["core/str"],function(b){var c=[{key:"wrong_filesize",component:"local_yumymedia"},{key:"unsupported_filetype",component:"local_yumymedia"},{key:"filesize",component:"local_yumymedia"},{key:"mimetype",component:"local_yumymedia"}];b.get_strings(c).then(function(b){if(h===!1&&(e+=b[0]),"N/A"==g&&(e+=b[1]),""!==e)window.alert(e),a("#file_info").html(""),a("#name").val(""),a("#tags").val(""),a("#description").val(""),a("#type").val(""),a("#fileData").val(""),D=0,E=0,C="";else{var c="",d="",i=0;A=f.name,B>1073741824?(i=B/1073741824,d=i.toFixed(2)+" G"):B>1048576?(i=B/1048576,d=i.toFixed(2)+" M"):B>1024?(i=B/1024,d=i.toFixed(2)+" k"):d=B+" ",c+="<div id=metadata_fields>",c+=b[2]+": "+d+"bytes<br>",c+=b[3]+":"+encodeURI(f.type)+"<br>",c+="</div><hr>",a("#file_info").html(c),a("#name").val(A),a("#type").val(g)}})}),"image"==g){var i=new Image;i.onload=function(){D=i.naturalWidth,E=i.naturalHeight,K(i.src),window.console.log(D),window.console.log(E)},i.src=J(f)}else D=0,E=0;C=g}b()}function f(){a("#file_info").html(""),a("#type").val(""),C="",D=0,E=0}function g(a){var b=/["$%&'~^\\`\/]/;return b.test(a)===!0?!1:!0}function h(a){var b=/[!"#$%&'~|^\\@`()[\]{}:;+*\/=<>?]/;return b.test(a)===!0?!1:!0}function i(){var b=a("#name").val(),c=a("#tags").val(),d=a("#description").val(),e=!0;return g(b)===!1&&(require(["core/str"],function(b){var c=b.get_string("wrong_name","local_yumymedia",null);a.when(c).done(function(a){window.alert(a)})}),e=!1),h(c)===!1&&(require(["core/str"],function(b){var c=b.get_string("wrong_tags","local_yumymedia",null);a.when(c).done(function(a){window.alert(a)})}),e=!1),g(d)===!1&&(require(["core/str"],function(b){var c=b.get_string("wrong_desc","local_yumymedia",null);a.when(c).done(function(a){window.alert(a)})}),e=!1),e}function j(){return i()===!1?!1:c()===!1?(require(["core/str"],function(b){var c=b.get_string("wrong_filesize","local_yumymedia",null);a.when(c).done(function(a){window.alert(a)})}),!1):(a("#entry_submit").prop("disabled",!0),t(),!0)}function k(){var b=a("#kalturahost").val(),c=b+"/api_v3/service/session/action/end";a.ajax({type:"GET",url:c,cache:!1}).done(function(a){null===a?window.console.log("Cannot delete the uploadToken ! (Cannot get a XML response.)"):window.console.log("Kaltura Session has been deleted.")}).fail(function(a){window.console.log("Cannot delete the uploadToken ! (Cannot connect to content server.)"),null!==a&&window.console.dir(a)})}function l(b,c,d){""!==c&&""!==d&&u(),a("#upload_info").html(""),a("#upload_info").append('<font color="red">'+b+"</font><br>"),q(),r()}function m(b,c,d,e,f){require(["core/str"],function(g){var h=[{key:"upload_success",component:"local_yumymedia"},{key:"entryid_header",component:"local_yumymedia"},{key:"name_header",component:"local_yumymedia"},{key:"tags_header",component:"local_yumymedia"},{key:"desc_header",component:"local_yumymedia"},{key:"creatorid_header",component:"local_yumymedia"},{key:"insert_media",component:"atto_yukaltura"}];g.get_strings(h).then(function(g){var h="<h3>"+g[0]+"</h3>";h+='<table border="2" cellpadding="5">',h+="<tr><td>"+g[1]+"</td><td>"+b+"</td></tr>",h+="<tr><td>"+g[2]+"</td><td>"+c+"</td></tr>",h+="<tr><td>"+g[3]+"</td><td>"+d+"</td></tr>",h+="<tr><td>"+g[4]+"</td><td>"+e+"</td></tr>",h+="<tr><td>"+g[5]+"</td><td>"+f+"</td></tr>",h+="</table>",h+="<br>",h+='<p><font color="red">'+g[6]+"</font></p>",a("#upload_info").html(h)})}),p(),r()}function n(){if(null===parent.document.getElementById("yukaltura_select_id")||null===parent.document.getElementById("yukaltura_select_id")[0]){var b=a("body",parent.document),c='<input type="hidden" name="yukaltura_select_id" id="yukaltura_select_id" value="">';b.append(c),c='<input type="hidden" name="yukaltura_select_name" id="yukaltura_select_name" value="">',b.append(c);var d=a("#kalturahost").val();c='<input type="hidden" name="yukaltura_host" id="yukaltura_host" value="',c=c+d+'">',b.append(c);var e=a("#partnerid").val();c='<input type="hidden" name="yukaltura_partnerid" id="yukaltura_partnerid" value="',c=c+e+'">',b.append(c);var f=a("#uiconfid").val();c='<input type="hidden" name="yukaltura_uiconfid" id="yukaltura_uiconfid" value="',c=c+f+'">',b.append(c);var g=a("#player_width").val();c='<input type="hidden" name="yukaltura_width" id="yukaltura_width" value="'+g+'">',b.append(c);var h=a("#player_height").val();c='<input type="hidden" name="yukaltura_height" id="yukaltura_height" value="'+h+'">',b.append(c),c='<input type="hidden" name="yukaltura_filetype" id="yukaltura_filetype" value="',c+=C+'">',b.append(c),c='<input type="hidden" name="yukaltura_filetype" id="yukaltura_filetype" value="">',b.append(c),c='<input type="hidden" name="yukaltura_naturalwidth" id="yukaltura_naturalwidth" value="">',b.append(c),c='<input type="hidden" name="yukaltura_naturalheight" id="yukaltura_naturalheight" value="">',b.append(c)}}function o(b,c){null!==b&&""!==b&&null!==parent.document.getElementById("yukaltura_select_id")&&null!==parent.document.getElementById("yukaltura_select_id")[0]&&(a("#yukaltura_select_id",parent.document).val(b),a("#yukaltura_select_name",parent.document).val(c),a("#yukaltura_filetype",parent.document).val(C),a("#yukaltura_naturalwidth",parent.document).val(D),a("#yukaltura_naturalheight",parent.document).val(E))}function p(){a("#yukaltura_insert_btn",parent.document).prop("disabled",!1),a("#yukaltura_insert_btn",parent.document).css({opacity:"1.0"})}function q(){a("#yukaltura_insert_btn",parent.document).prop("disabled",!0),a("#yukaltura_insert_btn",parent.document).css({opacity:"0.5"})}function r(){a("#yukaltura_cancel_btn",parent.document).prop("disabled",!1),a("#yukaltura_cancel_btn",parent.document).css({opacity:"1.0"})}function s(){a("#yukaltura_cancel_btn",parent.document).prop("disabled",!0),a("#yukaltura_cancel_btn",parent.document).css({opacity:"0.5"})}function t(){var b=a("#kalturahost").val(),c=a("#ks").val();q(),s(),n(),v(b,c)}function u(b,c,d){var e,f=new FormData;f.append("action","delete"),f.append("ks",c),f.append("uploadTokenId",d);var g={type:"POST",data:f,cache:!1,contentType:!1,scriptCharset:"utf-8",processData:!1,async:!0,dataType:"xml"},h=b+"/api_v3/service/uploadToken/action/delete";return a.ajax(h,g).done(function(a){null===a&&(e=!1),e=!0}).fail(function(a){e=!1,null!==a&&window.console.dir(a)}),e}function v(b,c){var d,e,f=a("#fileData").prop("files")[0];B=parseInt(encodeURI(f.size));var g={type:"GET",cache:!1,async:!0,contentType:!1,scriptCharset:"utf-8",dataType:"xml"},h=b+"/api_v3/service/uploadToken/action/add?ks="+c;h+="&uploadToken:objectType=KalturaUploadToken",h=h+"uploadToken:fileName="+encodeURI(A),h=h+"&uploadToken:fileSize="+B,h=h+"&uploadToken:autoFinalize="+G.NULL,a.ajax(h,g).done(function(f){if(null===f)return void l("Cannot create upload token !<br>(Cannot get a XML response.)");if(e=a(f).find("code"),null!==e&&void 0!==typeof e&&""!==e.text())return void l("Cannot create upload token !<br>("+e.text()+")");if(e=a(f).find("status"),null===e||void 0===typeof e||""===e.text())return void l("Cannot create upload token !<br>(Cannot get status of upload token.)");var g=e.text();return g!=I.PENDING?void l("Cannot create upload token !<br>(UPLOAD_TOKEN_STATUS : "+g+")"):(e=a(f).find("id"),null===e||void 0===typeof e||""===e.text()?void l("Cannot create uplaod token !<br>(Cannot get an uploadTokenId.)"):(d=e.text(),void setTimeout(function(){w(b,c,d)},50)))}).fail(function(a){null!==a&&window.console.dir(a),l("Cannot create upload token !<br>(Cannot connect to kaltura server.)")})}function w(b,c,d){var e,f,g="",h="",i="",j="",k="",m=a("#name").val(),n=a("#tags").val(),o=a("#description").val(),p=a("#controlId").val(),q=a("#creatorId").val();m=m.trim(),n=n.trim(),null!==o&&(o=o.trim());var r=new FormData;r.append("action","add"),r.append("ks",c),r.append("entry:objectType","KalturaMediaEntry");var s=a("#type").val(),t="";t="image"==s?F.IMAGE:"audio"==s?F.AUDIO:F.VIDEO,r.append("entry:mediaType",t),r.append("entry:sourceType",1),r.append("entry:name",m),r.append("entry:tags",n),null!==o&&""!==o?r.append("entry:description",o):r.append("entry:description",""),r.append("entry:categories",a("#categories").val()),null!==p&&""!==p&&r.append("entry:accessControlId",p),r.append("entry:creatorId",q),r.append("entry:userId",q);var v={type:"POST",data:r,cache:!1,async:!0,contentType:!1,scriptCharset:"utf-8",processData:!1,dataType:"xml"},w=b+"/api_v3/service/media/action/add";a.ajax(w,v).done(function(m){return null===m||void 0===typeof m?(u(b,c,d),void l("Cannot create media entry !<br>(Cannot get a XML response.)")):(e=a(m).find("code"),null!==e&&void 0!==typeof e&&""!==e.text()?(u(b,c,d),void l("Cannot create media entry !<br>("+e.text()+")")):(e=a(m).find("status"),null===e||void 0===typeof e||""===e.text()?(u(b,c,d),void l("Cannot create media entyry !<br>(Cannot get a mediaEntryStatus.)")):(f=e.text(),f!=H.ENTRY_NO_CONTENT?(u(b,c,d),void l("Cannot create media entry!<br>(mediaEntryStatus: "+f+")")):(e=a(m).find("id"),g=e.text(),e=a(m).find("name"),h=e.text(),e=a(m).find("tags"),i=e.text(),e=a(m).find("description"),j=null!==e&&void 0!==typeof e&&""!==e.text()?e.text():"",e=a(m).find("creatorId"),k=e.text(),null===g||""===g||null===h||""===h||null===i||""===i||null===k||""===k||""!==o&&(null===j||""===j)?(u(b,c,d),void l("There exists wrong information(s) <br>")):void setTimeout(function(){x(b,c,d,g)},50)))))}).fail(function(a){null!==a&&window.console.dir(a),u(b,c,d),l("Cannot create media entry !<br>(Cannot connect to kaltura server.)")})}function x(b,c,d,e){var f,g=new FormData;g.append("action","upload"),g.append("ks",c),g.append("uploadTokenId",d),g.append("fileData",a("input[name='fileData']").prop("files")[0],encodeURI(A),B),g.append("resume",!1),g.append("finalChunk",!0),g.append("resumeAt",0);var h={type:"POST",data:g,cache:!1,async:!0,contentType:!1,scriptCharset:"utf-8",processData:!1,dataType:"xml",xhr:function(){var b=a.ajaxSettings.xhr();return b.upload&&b.upload.addEventListener("progress",function(b){var c=parseInt(b.loaded/b.total*100);a("#pvalue").html(parseInt(c))},!1),b}};a("#upload_info").html(""),require(["core/str"],function(b){var c=b.get_string("uploader_uploading","local_yumymedia",null);a.when(c).done(function(b){a("#upload_info").append(b+"<br>")})}),require(["core/str"],function(b){var c=b.get_string("progress","local_yumymedia",null);a.when(c).done(function(b){a("#upload_info").append("<p>"+b+': <span id="pvalue" style="color:#00b200">0.00</span> %</p>')})});var i=b+"/api_v3/service/uploadToken/action/upload";a.ajax(i,h).done(function(g,h,i){if(null===g)return u(b,c,d),void l("Cannot upload the video !<br>(Cannot get a XML response.)");if(f=a(g).find("code"),null!==f&&void 0!==typeof f&&""!==f.text())return u(b,c,d),void l("Cannot upload the video !<br>("+f.text()+")");if(f=a(g).find("status"),null===f||void 0===typeof f||""===f.text())return u(b,c,d),void l("Cannot upload the video !<br>(Cannot get an uploadTokenStatus.)");var j=f.text();return j!=I.FULL_UPLOAD&&j!=I.PARTIAL_UPLOAD?(u(b,c,d),void l("Cannot upload the video !<br>(UPLOAD_TOKEN_STATUS : "+j+")")):(window.console.log("File chunk have been transmitted."),require(["core/str"],function(b){var c=b.get_string("attach_file","local_yumymedia",null);a.when(c).done(function(b){a("#upload_info").append(b+"<br>")})}),void setTimeout(function(){y(b,c,d,e)},1e3))}).fail(function(a){null!==a&&window.console.dir(a),u(b,c,d),l("Cannot upload the file !<br>(Cannot connect to contents server.)")})}function y(b,c,d,e){var f,g,h="",i="",j="",k="",n=new FormData;n.append("action","addContent"),n.append("ks",c),n.append("entryId",e),n.append("resource:objectType","KalturaUploadedFileTokenResource"),n.append("resource:token",d);var p={type:"POST",data:n,cache:!1,async:!0,contentType:!1,scriptCharset:"utf-8",processData:!1,dataType:"xml"},q=b+"/api_v3/service/media/action/addContent";a.ajax(q,p).done(function(n){return null===n||void 0===typeof n?(u(b,c,d),void l("Cannot attach uploaded file !<br>(Cannot get a XML response.)")):(g=a(n).find("code"),null!==g&&void 0!==typeof g&&""!==g.text()?(u(b,c,d),void l("Cannot attach uploaded file !<br>("+g.text()+")")):(g=a(n).find("status"),null===g||void 0===typeof g||""===g.text()?(u(b,c,d),void l("Cannot attach uploaded file !<br>(Cannot get a mediaEntryStatus.)")):(f=g.text(),f!=H.ENTRY_READY&&f!=H.ENTRY_PENDING&&f!=H.ENTRY_PRECONVERT&&f!=H.IMPORT&&f!=H.IMPORTING?(u(b,c,d),void l("Cannot attach uploaded file !<br>(mediaEntryStatus: "+f+")")):(g=a(n).find("id"),e=g.text(),g=a(n).find("name"),h=g.text(),g=a(n).find("tags"),i=g.text(),g=a(n).find("description"),j=null!==g&&void 0!==typeof g&&""!==g.text()?g.text():"",g=a(n).find("creatorId"),k=g.text(),m(e,h,i,j,k),void o(e,h)))))}).fail(function(a){null!==a&&window.console.dir(a),u(b,c,d),l("Cannot attach uploaded file !<br>(Cannot connect to kaltura server.)")})}function z(){a("#yukaltura_select_id",parent.document).remove(),a("#yukaltura_select_name",parent.document).remove(),a("#yukaltura_host",parent.document).remove(),a("#yukaltura_partnerid",parent.document).remove(),a("#yukaltura_uiconfid",parent.document).remove(),a("#yukaltura_width",parent.document).remove(),a("#yukaltura_height",parent.document).remove(),a("#yukaltura_filetype",parent.document).remove(),a("#yukaltura_naturalwidth",parent.document).remove(),a("#yukaltura_naturalheight",parent.document).remove()}var A="",B=0,C="",D=0,E=0,F={VIDEO:1,IMAGE:2,AUDIO:5},G={TRUE:1,FALSE:0,NULL:-1},H={ENTRY_IMPORTING:-2,ENTRY_CONVERTING:-1,ENTRY_IMPORT:0,ENTRY_PRECONVERT:1,ENTRY_READY:2,ENTRY_DELETED:3,ENTRY_PENDING:4,ENTRY_MODERATE:5,ENTRY_BLOCKED:6,ENTRY_NO_CONTENT:7},I={PENDING:0,PARTIAL_UPLOAD:1,FULL_UPLOAD:2,CLOSED:3,TIMED_OUT:4,DELETED:5},J=window.URL&&window.URL.createObjectURL?function(a){return window.URL.createObjectURL(a)}:window.webkitURL&&window.webkitURL.createObjectURL?function(a){return window.webkitURL.createObjectURL(a)}:void 0,K=window.URL&&window.URL.revokeObjectURL?function(a){return window.URL.revokeObjectURL(a)}:window.webkitURL&&window.webkitURL.revokeObjectURL?function(a){return window.webkitURL.revokeObjectURL(a)}:void 0;a(window).on("change",function(){b()}),a(window).on("unload",function(){k()}),a("#fileData").on("change",function(){e()}),a("#name").on("change",function(){b()}),a("#tags").on("change",function(){b()}),a("#entry_submit").on("click",function(){j()}),a("#entry_reset").on("click",function(){f()}),z(),q(),r()}}});