YUI.add("moodle-atto_yukaltura-button",function(e,t){var n="atto_yukaltura",r="yukaltura_media",i={INPUTSUBMIT:"yukaltura_insert_btn",INPUTCANCEL:"yukaltura_cancel_btn"},s="";s='<iframe src="{{url}}" width="680px" height="580px" name="yukaltura_frame" id="yukaltura_frame_{{elementid}}"></iframe><div align="right"><input type="button" class="{{CSS.INPUTSUBMIT}}" id="{{CSS.INPUTSUBMIT}}" name="{{CSS.INPUTSUBMIT}}" value={{get_string "insert" component}}>&nbsp;<input type="button" class="{{CSS.INPUTCANCEL}}" id="{{CSS.INPUTCANCEL}}" name="{{CSS.INPUTCANCEL}}" value={{get_string "cancel" component}}></div><input type="hidden" id="select_id" name="select_id" value="">';var o="";e.namespace("M.atto_yukaltura").Button=e.Base.create("button",e.M.editor_atto.EditorPlugin,[],{initializer:function(){if(this.get("disabled"))return;this.get("enablemymedia")==1&&(this.addButton({icon:"ed/selector",iconComponent:"atto_yukaltura",buttonName:"selector",title:"selector_button_title",callback:this._displaySelector,callbackArgs:"selector"}),this.get("enableuploading")==1&&(this.addButton({icon:"ed/uploader",iconComponent:"atto_yukaltura",buttonName:"uploader",title:"uploader_button_title",callback:this._displayUploader,callbackArgs:"uploader"}),this.get("enablerecording")==1&&this.addButton({icon:"ed/recorder",iconComponent:"atto_yukaltura",buttonName:"recorder",title:"recorder_button_title",callback:this._displayRecorder,callbackArgs:"recorder"})))},_getMediaControlName:function(){return this.get("host").get("elementid")+"_"+r},_displaySelector:function(t,r){t.preventDefault();var i=700,s=720,u=this.getDialogue({headerContent:M.util.get_string("form_title",n),width:i+"px",height:s+"px",focusAfterHide:r});u.width!==i+"px"&&u.set("width",i+"px"),u.height!==s+"px"&&u.set("height",s+"px");var a=this._getFormContent("selectorurl"),f=e.Node.create('<div id="selector_'+o+'" name="selector_'+o+'"></div>');f.append(a),u.set("bodyContent",f),u.show(),this.markUpdated()},_displayUploader:function(t,r){t.preventDefault();var i=700,s=720,u=this.getDialogue({headerContent:M.util.get_string("form_title",n),width:i+"px",height:s+"px",focusAfterHide:r});u.width!==i+"px"&&u.set("width",i+"px"),u.height!==s+"px"&&u.set("height",s+"px");var a=this._getFormContent("uploaderurl"),f=e.Node.create('<div id="uploader_'+o+'" name="uploader_'+o+'"></div>');f.append(a),u.set("bodyContent",f),u.show(),this.markUpdated()},_displayRecorder:function(t,r){t.preventDefault();var i=700,s=720,u=this.getDialogue({headerContent:M.util.get_string("form_title",n),width:i+"px",height:s+"px",focusAfterHide:r});u.width!==i+"px"&&u.set("width",i+"px"),u.height!==s+"px"&&u.set("height",s+"px");var a=this._getFormContent("recorderurl"),f=e.Node.create('<div id="recorder_'+o+'" name="recorder_'+o+'"></div>');f.append(a),u.set("bodyContent",f),u.show(),this.markUpdated()},_getFormContent:function(t){var r=e.Handlebars.compile(s),u=e.Node.create(r({elementid:this.get("host").get("elementid"),CSS:i,component:n,url:this.get(t)}));return o=this.get("host").get("elementid"),this._form=u,this._form.one("."+i.INPUTSUBMIT).on("click",this._doInsert,this),this._form.one("."+i.INPUTCANCEL).on("click",this._doCancel,this),u},_doInsert:function(t){t.preventDefault(),this.getDialogue({focusAfterHide:null}).hide(),this.editor.focus();if(e.one("#yukaltura_select_id")!==null){var n=e.one("#yukaltura_select_id").get("value"),r=e.one("#yukaltura_select_name").get("value"),i=e.one("#yukaltura_host").get("value"),s=e.one("#yukaltura_partnerid").get("value"),o=e.one("#yukaltura_uiconfid").get("value"),u=e.one("#yukaltura_width").get("value"),a=e.one("#yukaltura_height").get("value"),f=e.one("#yukaltura_filetype").get("value"),l=e.one("#yukaltura_naturalwidth").get("value"),c=e.one("#yukaltura_naturalheight").get("value"),h=new Date,p=h.getTime(),d="";if(n!==null&&n!==""&&i!==null&&i!==""&&s!==null&&s!==""&&o!==null&&o!==""&&u!==null&&u!==""&&a!==null&&a!==""){if(f=="image"&&l>0&&c>0){var v=i+"/p/"+s+"/sp/"+s+"00/thumbnail/entry_id/";v+=n+"/def_height/"+c+"/def_width/"+l+"/type/1";var m=0,g=0;if(l>640||c>480){var y=l/640,b=c/480;y>=b?(m=Math.floor(l/y),g=Math.floor(c/y)):(m=Math.floor(l/b),g=Math.floor(c/b));var w=i+"/p/"+s+"/sp/"+s;w+="00/thumbnail/entry_id/"+n+"/def_height/"+g,w+="/def_width/"+m+"/type/1",d+='<a href="'+v+'" target="_new">',d+='<img src="'+w,d+='" width="'+m+'" height="'+g,d+='" alt="'+r+'" title="'+r+'" border="0" />',d+="</a>"}else d+='<img src="'+v,d+='" width="'+l+'" height="'+c,d+='" alt="'+r+'" title="'+r+'" border="0" />'}else d+='<iframe src="'+i+"/p/"+s+"/sp/"+s+"00/",d+="embedIframeJs/uiconf_id/"+o+"/partner_id/"+s+"?",d+="iframeembed=true&playerId=kaltura_player_"+p+"&entry_id="+n,d+='" width="'+u+'" height="'+a+'" allowfullscreen webkitallowfullscreen ',d+='mozAllowFullScreen frameborder="0" allow="encrypted-media"></iframe>';this.get("host").insertContentAtFocusPoint(d),this.markUpdated()}}this._removeParameters()},_doCancel:function(e){e.preventDefault(),this.getDialogue({focusAfterHide:null}).hide(),this.editor.focus(),this._removeParameters()},_removeParameters:function(){e.all("#yukaltura_select_id").remove(),e.all("#yukaltura_select_name").remove(),e.all("#yukaltura_host").remove(),e.all("#yukaltura_partnerid").remove(),e.all("#yukaltura_uiconfid").remove(),e.all("#yukaltura_width").remove(),e.all("#yukaltura_height").remove(),e.all("#yukaltura_filetype").remove(),e.all("#yukaltura_naturalwidth").remove(),e.all("#yukaltura_naturalheight").remove()}},{ATTRS:{disabled:{value:!1},usercontextid:{value:null},selectorurl:{value:""},uploaderurl:{value:""},recorderurl:{value:""},enablemymedia:{value:0},enableuploading:{value:0},enablerecording:{value:0}}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});
